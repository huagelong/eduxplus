{% extends "@AdminBundle/layout/main.html.twig" %}
{% import "@AdminBundle/macros/helpcategory_tree.html.twig" as macros %}

{% block page_title %}帮助分类管理{% endblock %}

{% block head_custom_stylesheets %}
  <link rel="stylesheet" href="{{ asset('assets/plugins/jquery-nestable2/jquery.nestable.min.css') }}">
  <link rel="stylesheet" href="{{ asset('assets/plugins/fontawesome-iconpicker/css/fontawesome-iconpicker.min.css') }}">
{% endblock %}

{% block body_javascript %}
  {{ parent() }}
  <script src="{{ asset('assets/plugins/jquery-nestable2/jquery.nestable.min.js') }}"></script>
  <script src="{{ asset('assets/plugins/fontawesome-iconpicker/js/fontawesome-iconpicker.min.js') }}"></script>
{% endblock %}

{% block body_custom_javascript %}
  <script>
    $(function(){

      $('#tree').nestable({scroll:true});

      $('.tree-tools').on('click', function(e){
        var action = $(this).data('action');
        if (action === 'expand') {
          $('.dd').nestable('expandAll');
        }
        if (action === 'collapse') {
          $('.dd').nestable('collapseAll');
        }
        $('.tree-tools').removeClass("active");
        $(this).addClass("active");
      });

      $("#sortSave").click(function(){
        var serialize = $('#tree').nestable('serialize');
        requestPost('{{ path('admin_api_mall_help_category_updateSort') }}', serialize);
      });
    });
  </script>
{% endblock %}

{% block page %}
  <section class="content">
    <div class="row">
      <div class="col-md-6">
        <div class="card card-default">
          <div class="card-header">
            <div class="btn-group">
              <button class="btn btn-primary btn-sm tree-tools" data-action="expand" title="展开">
                <i class="fas fa-plus-square-o"></i>&nbsp;展开
              </button>
              <button class="btn btn-primary btn-sm tree-tools active" data-action="collapse"
                      title="收起">
                <i class="fas fa-minus-square-o"></i>&nbsp;收起
              </button>
            </div>
            {% if is_authorized('admin_api_mall_help_category_updateSort') %}
              <div class="btn-group">
                <button class="btn btn-info btn-sm" id="sortSave" title="保存">
                  <i class="fas fa-save"></i><span class="hidden-xs">&nbsp;保存排序 </span>
                </button>
              </div>
            {% endif %}
          </div>
          <!-- /.box-header -->
          <div class="card-body table-responsive no-padding">
            <div class="dd" id="tree">
              {{ macros.helpcategory_tree(categorys) }}
            </div>
          </div>
          <!-- /.box-body -->
        </div>
      </div>
      {% if is_authorized('admin_api_mall_help_category_add') %}
        <div class="col-md-6">
          {{ addFormData|raw }}
        </div>
      {% endif %}
    </div>
  </section>
{% endblock %}
